<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Performance Fire Salamander</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .test-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metric {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            border-left: 4px solid #ff6b35;
        }
        .status-ok { color: #27ae60; font-weight: bold; }
        .status-warning { color: #f39c12; font-weight: bold; }
        .status-error { color: #e74c3c; font-weight: bold; }
        .button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .button:hover { background: #e55a2e; }
        iframe {
            width: 100%;
            height: 400px;
            border: 2px solid #ddd;
            border-radius: 8px;
        }
        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        @media (max-width: 768px) {
            .comparison { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ Test de Performance Fire Salamander</h1>
        
        <div class="test-section">
            <h2>üìä M√©triques de Chargement</h2>
            <button class="button" onclick="runPerformanceTest()">üß™ Lancer le Test</button>
            <div id="performance-results"></div>
        </div>
        
        <div class="test-section">
            <h2>üîç Comparaison des Interfaces</h2>
            <div class="comparison">
                <div>
                    <h3>Interface Originale</h3>
                    <div id="original-metrics"></div>
                    <iframe src="http://localhost:8080" title="Interface Originale"></iframe>
                </div>
                <div>
                    <h3>Interface L√©g√®re</h3>
                    <div id="light-metrics"></div>
                    <iframe src="simple_interface.html" title="Interface L√©g√®re"></iframe>
                </div>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üêõ Diagnostic des Probl√®mes</h2>
            <div id="diagnostic-results">
                <button class="button" onclick="runDiagnostics()">üîß Diagnostic Complet</button>
            </div>
        </div>
        
        <div class="test-section">
            <h2>üí° Solutions Recommand√©es</h2>
            <div id="recommendations">
                <p>Cliquez sur "Diagnostic Complet" pour obtenir des recommandations personnalis√©es.</p>
            </div>
        </div>
    </div>

    <script>
        // Test de performance
        async function runPerformanceTest() {
            const container = document.getElementById('performance-results');
            container.innerHTML = '<p>Test en cours...</p>';
            
            const results = {};
            
            try {
                // Test 1: Temps de chargement de l'interface originale
                const startTime = performance.now();
                const response = await fetch('http://localhost:8080/');
                const html = await response.text();
                const loadTime = performance.now() - startTime;
                
                results.htmlLoadTime = loadTime;
                results.htmlSize = html.length;
                
                // Test 2: Temps de chargement CSS
                const cssStart = performance.now();
                const cssResponse = await fetch('http://localhost:8080/styles.css');
                const css = await cssResponse.text();
                const cssLoadTime = performance.now() - cssStart;
                
                results.cssLoadTime = cssLoadTime;
                results.cssSize = css.length;
                
                // Test 3: Temps de chargement JS
                const jsStart = performance.now();
                const jsResponse = await fetch('http://localhost:8080/app.js');
                const js = await jsResponse.text();
                const jsLoadTime = performance.now() - jsStart;
                
                results.jsLoadTime = jsLoadTime;
                results.jsSize = js.length;
                
                // Test 4: Temps de r√©ponse API
                const apiStart = performance.now();
                const apiResponse = await fetch('http://localhost:8080/api/v1/health');
                const apiData = await apiResponse.json();
                const apiLoadTime = performance.now() - apiStart;
                
                results.apiLoadTime = apiLoadTime;
                
                // Afficher les r√©sultats
                const totalTime = results.htmlLoadTime + results.cssLoadTime + results.jsLoadTime;
                const totalSize = results.htmlSize + results.cssSize + results.jsSize;
                
                container.innerHTML = `
                    <h3>R√©sultats du Test de Performance:</h3>
                    
                    <div class="metric">
                        <strong>üìÑ HTML:</strong> ${results.htmlSize.toLocaleString()} bytes - ${results.htmlLoadTime.toFixed(2)}ms
                        <span class="${results.htmlLoadTime < 100 ? 'status-ok' : results.htmlLoadTime < 300 ? 'status-warning' : 'status-error'}">
                            ${results.htmlLoadTime < 100 ? '‚úÖ Rapide' : results.htmlLoadTime < 300 ? '‚ö†Ô∏è Moyen' : '‚ùå Lent'}
                        </span>
                    </div>
                    
                    <div class="metric">
                        <strong>üé® CSS:</strong> ${results.cssSize.toLocaleString()} bytes - ${results.cssLoadTime.toFixed(2)}ms
                        <span class="${results.cssLoadTime < 50 ? 'status-ok' : results.cssLoadTime < 150 ? 'status-warning' : 'status-error'}">
                            ${results.cssLoadTime < 50 ? '‚úÖ Rapide' : results.cssLoadTime < 150 ? '‚ö†Ô∏è Moyen' : '‚ùå Lent'}
                        </span>
                    </div>
                    
                    <div class="metric">
                        <strong>‚ö° JavaScript:</strong> ${results.jsSize.toLocaleString()} bytes - ${results.jsLoadTime.toFixed(2)}ms
                        <span class="${results.jsLoadTime < 100 ? 'status-ok' : results.jsLoadTime < 300 ? 'status-warning' : 'status-error'}">
                            ${results.jsLoadTime < 100 ? '‚úÖ Rapide' : results.jsLoadTime < 300 ? '‚ö†Ô∏è Moyen' : '‚ùå Lent'}
                        </span>
                    </div>
                    
                    <div class="metric">
                        <strong>üì° API:</strong> ${results.apiLoadTime.toFixed(2)}ms
                        <span class="${results.apiLoadTime < 50 ? 'status-ok' : results.apiLoadTime < 200 ? 'status-warning' : 'status-error'}">
                            ${results.apiLoadTime < 50 ? '‚úÖ Rapide' : results.apiLoadTime < 200 ? '‚ö†Ô∏è Moyen' : '‚ùå Lent'}
                        </span>
                    </div>
                    
                    <div class="metric">
                        <strong>üìä Total:</strong> ${totalSize.toLocaleString()} bytes - ${totalTime.toFixed(2)}ms
                        <span class="${totalTime < 500 ? 'status-ok' : totalTime < 1000 ? 'status-warning' : 'status-error'}">
                            ${totalTime < 500 ? '‚úÖ Performance Excellente' : totalTime < 1000 ? '‚ö†Ô∏è Performance Correcte' : '‚ùå Performance Lente'}
                        </span>
                    </div>
                `;
                
            } catch (error) {
                container.innerHTML = `
                    <div class="metric">
                        <span class="status-error">‚ùå Erreur de test:</span> ${error.message}
                    </div>
                `;
            }
        }
        
        // Diagnostic complet
        async function runDiagnostics() {
            const container = document.getElementById('diagnostic-results');
            const recommendations = document.getElementById('recommendations');
            
            container.innerHTML = '<p>Diagnostic en cours...</p>';
            
            const issues = [];
            const fixes = [];
            
            try {
                // Test des ressources externes (CDN)
                const cdnTests = [
                    'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js'
                ];
                
                for (const url of cdnTests) {
                    try {
                        const start = performance.now();
                        const response = await fetch(url, { method: 'HEAD' });
                        const loadTime = performance.now() - start;
                        
                        if (!response.ok) {
                            issues.push(`CDN inaccessible: ${url}`);
                            fixes.push('Utiliser des versions locales des biblioth√®ques externes');
                        } else if (loadTime > 2000) {
                            issues.push(`CDN lent: ${url} (${loadTime.toFixed(0)}ms)`);
                            fixes.push('Consid√©rer un CDN plus rapide ou des versions locales');
                        }
                    } catch (e) {
                        issues.push(`Erreur CDN: ${url} - ${e.message}`);
                        fixes.push('V√©rifier la connexion Internet et utiliser des versions locales');
                    }
                }
                
                // Test de la m√©moire du navigateur
                if (performance.memory) {
                    const memory = performance.memory;
                    if (memory.usedJSHeapSize > 50 * 1024 * 1024) { // 50MB
                        issues.push(`Utilisation m√©moire √©lev√©e: ${(memory.usedJSHeapSize / 1024 / 1024).toFixed(1)}MB`);
                        fixes.push('Optimiser le JavaScript et lib√©rer les r√©f√©rences inutiles');
                    }
                }
                
                // Test de la compatibilit√© navigateur
                const features = [
                    { name: 'fetch', test: () => typeof fetch !== 'undefined' },
                    { name: 'Promise', test: () => typeof Promise !== 'undefined' },
                    { name: 'CSS Grid', test: () => CSS.supports('display', 'grid') },
                    { name: 'CSS Variables', test: () => CSS.supports('color', 'var(--test)') }
                ];
                
                for (const feature of features) {
                    if (!feature.test()) {
                        issues.push(`Fonctionnalit√© non support√©e: ${feature.name}`);
                        fixes.push(`Ajouter un polyfill pour ${feature.name} ou simplifier l'interface`);
                    }
                }
                
                // Afficher les r√©sultats
                let html = '<h3>R√©sultats du Diagnostic:</h3>';
                
                if (issues.length === 0) {
                    html += '<div class="metric"><span class="status-ok">‚úÖ Aucun probl√®me technique d√©tect√©!</span></div>';
                    recommendations.innerHTML = `
                        <h3>‚úÖ Interface Techniquement Saine</h3>
                        <p>Les tests ne r√©v√®lent aucun probl√®me technique majeur. Si l'affichage reste incoh√©rent, le probl√®me peut venir de :</p>
                        <ul>
                            <li><strong>Cache du navigateur:</strong> Videz le cache (Ctrl+F5)</li>
                            <li><strong>Extensions:</strong> D√©sactivez les extensions (mode incognito)</li>
                            <li><strong>Navigateur:</strong> Testez avec un autre navigateur</li>
                            <li><strong>R√©solution:</strong> Testez avec diff√©rentes tailles d'√©cran</li>
                        </ul>
                        <p><strong>Actions recommand√©es:</strong></p>
                        <ol>
                            <li>Ouvrir en mode incognito: <code>Ctrl+Shift+N</code></li>
                            <li>Vider le cache: <code>Ctrl+Shift+Del</code></li>
                            <li>Forcer le rechargement: <code>Ctrl+F5</code></li>
                            <li>Tester l'interface l√©g√®re: <a href="simple_interface.html">simple_interface.html</a></li>
                        </ol>
                    `;
                } else {
                    issues.forEach(issue => {
                        html += `<div class="metric"><span class="status-warning">‚ö†Ô∏è ${issue}</span></div>`;
                    });
                    
                    let recHtml = '<h3>üîß Solutions Recommand√©es:</h3><ol>';
                    fixes.forEach(fix => {
                        recHtml += `<li>${fix}</li>`;
                    });
                    recHtml += '</ol>';
                    
                    recommendations.innerHTML = recHtml;
                }
                
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `<div class="metric"><span class="status-error">‚ùå Erreur de diagnostic:</span> ${error.message}</div>`;
            }
        }
        
        // Mesurer les performances des iframes
        function measureIframePerformance() {
            const originalMetrics = document.getElementById('original-metrics');
            const lightMetrics = document.getElementById('light-metrics');
            
            // Observer les iframes
            const originalIframe = document.querySelector('iframe[src="http://localhost:8080"]');
            const lightIframe = document.querySelector('iframe[src="simple_interface.html"]');
            
            const originalStart = performance.now();
            originalIframe.onload = () => {
                const originalTime = performance.now() - originalStart;
                originalMetrics.innerHTML = `<div class="metric">Temps de chargement: ${originalTime.toFixed(2)}ms</div>`;
            };
            
            const lightStart = performance.now();
            lightIframe.onload = () => {
                const lightTime = performance.now() - lightStart;
                lightMetrics.innerHTML = `<div class="metric">Temps de chargement: ${lightTime.toFixed(2)}ms</div>`;
            };
        }
        
        // Initialiser au chargement
        window.onload = () => {
            measureIframePerformance();
        };
    </script>
</body>
</html>