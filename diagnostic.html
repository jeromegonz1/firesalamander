<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diagnostic Fire Salamander</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .diagnostic-section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-ok { color: #27ae60; font-weight: bold; }
        .status-error { color: #e74c3c; font-weight: bold; }
        .status-warning { color: #f39c12; font-weight: bold; }
        pre { background: #f5f5f5; padding: 10px; overflow-x: auto; }
        .test-button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover { background: #e55a2e; }
    </style>
</head>
<body>
    <h1>üî• Diagnostic de l'Interface Fire Salamander</h1>
    
    <div class="diagnostic-section">
        <h2>1. Test de Chargement des Ressources</h2>
        <div id="resource-test"></div>
    </div>
    
    <div class="diagnostic-section">
        <h2>2. Test de l'API</h2>
        <button class="test-button" onclick="testAPI()">Tester l'API</button>
        <div id="api-test"></div>
    </div>
    
    <div class="diagnostic-section">
        <h2>3. Test d'Analyse</h2>
        <input type="url" id="test-url" value="https://www.campinglacivelle.fr" style="width: 300px; padding: 5px;">
        <button class="test-button" onclick="testAnalysis()">Lancer l'Analyse</button>
        <div id="analysis-test"></div>
    </div>
    
    <div class="diagnostic-section">
        <h2>4. Erreurs Console</h2>
        <div id="console-errors"></div>
    </div>
    
    <div class="diagnostic-section">
        <h2>5. Screenshot de l'Interface</h2>
        <p>Ouvrez l'interface dans un nouvel onglet pour la tester :</p>
        <a href="http://localhost:8080" target="_blank" class="test-button" style="display: inline-block; text-decoration: none;">
            Ouvrir Fire Salamander
        </a>
    </div>

    <script>
        // Log des erreurs console
        const consoleErrors = [];
        window.addEventListener('error', (e) => {
            consoleErrors.push({
                message: e.message,
                source: e.filename,
                line: e.lineno,
                col: e.colno
            });
            updateConsoleErrors();
        });

        function updateConsoleErrors() {
            const container = document.getElementById('console-errors');
            if (consoleErrors.length === 0) {
                container.innerHTML = '<span class="status-ok">‚úÖ Aucune erreur console</span>';
            } else {
                container.innerHTML = '<span class="status-error">‚ùå Erreurs d√©tect√©es:</span><pre>' + 
                    JSON.stringify(consoleErrors, null, 2) + '</pre>';
            }
        }

        // Test de chargement des ressources
        async function testResources() {
            const container = document.getElementById('resource-test');
            let html = '<h3>Ressources externes:</h3><ul>';
            
            // Test CSS
            try {
                const cssResponse = await fetch('http://localhost:8080/styles.css');
                const cssText = await cssResponse.text();
                html += `<li><span class="status-ok">‚úÖ CSS</span> - ${cssText.length} caract√®res</li>`;
            } catch (e) {
                html += `<li><span class="status-error">‚ùå CSS</span> - ${e.message}</li>`;
            }
            
            // Test JS
            try {
                const jsResponse = await fetch('http://localhost:8080/app.js');
                const jsText = await jsResponse.text();
                html += `<li><span class="status-ok">‚úÖ JavaScript</span> - ${jsText.length} caract√®res</li>`;
            } catch (e) {
                html += `<li><span class="status-error">‚ùå JavaScript</span> - ${e.message}</li>`;
            }
            
            // Test des CDN
            html += '<li>Chart.js: ' + (typeof Chart !== 'undefined' ? 
                '<span class="status-ok">‚úÖ Charg√©</span>' : 
                '<span class="status-error">‚ùå Non charg√©</span>') + '</li>';
            
            html += '<li>Moment.js: ' + (typeof moment !== 'undefined' ? 
                '<span class="status-ok">‚úÖ Charg√©</span>' : 
                '<span class="status-error">‚ùå Non charg√©</span>') + '</li>';
            
            html += '</ul>';
            container.innerHTML = html;
        }

        // Test API
        async function testAPI() {
            const container = document.getElementById('api-test');
            container.innerHTML = '<p>Test en cours...</p>';
            
            try {
                // Test health
                const healthResponse = await fetch('http://localhost:8080/api/v1/health');
                const healthData = await healthResponse.json();
                
                // Test stats
                const statsResponse = await fetch('http://localhost:8080/api/v1/stats');
                const statsData = await statsResponse.json();
                
                container.innerHTML = `
                    <h3>R√©sultats API:</h3>
                    <p><span class="status-ok">‚úÖ Health endpoint</span> - Status: ${healthData.data.status}</p>
                    <p><span class="status-ok">‚úÖ Stats endpoint</span> - Total tasks: ${statsData.data.total_tasks}</p>
                    <details>
                        <summary>D√©tails Health</summary>
                        <pre>${JSON.stringify(healthData, null, 2)}</pre>
                    </details>
                    <details>
                        <summary>D√©tails Stats</summary>
                        <pre>${JSON.stringify(statsData, null, 2)}</pre>
                    </details>
                `;
            } catch (error) {
                container.innerHTML = `<span class="status-error">‚ùå Erreur API:</span> ${error.message}`;
            }
        }

        // Test d'analyse
        async function testAnalysis() {
            const container = document.getElementById('analysis-test');
            const url = document.getElementById('test-url').value;
            
            container.innerHTML = '<p>Analyse en cours... (peut prendre 30-60 secondes)</p>';
            
            try {
                const response = await fetch('http://localhost:8080/api/v1/analyze/quick', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ url: url })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    container.innerHTML = `
                        <h3><span class="status-ok">‚úÖ Analyse r√©ussie!</span></h3>
                        <p>URL: ${data.data.url}</p>
                        <p>Score global: ${(data.data.overall_score * 100).toFixed(1)}/100</p>
                        <p>Temps de traitement: ${(data.data.processing_time / 1000000000).toFixed(2)}s</p>
                        <details>
                            <summary>R√©sultats complets</summary>
                            <pre>${JSON.stringify(data.data, null, 2)}</pre>
                        </details>
                    `;
                } else {
                    container.innerHTML = `<span class="status-error">‚ùå Erreur:</span> ${data.error}`;
                }
            } catch (error) {
                container.innerHTML = `<span class="status-error">‚ùå Erreur r√©seau:</span> ${error.message}`;
            }
        }

        // Charger les tests au d√©marrage
        window.onload = () => {
            testResources();
            updateConsoleErrors();
        };
    </script>
    
    <!-- Charger les CDN n√©cessaires -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
</body>
</html>