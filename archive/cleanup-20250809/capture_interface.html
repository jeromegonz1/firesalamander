<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Capture Interface Fire Salamander</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f8f9fa;
        }
        .section {
            background: white;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-ok { color: #27ae60; font-weight: bold; }
        .status-error { color: #e74c3c; font-weight: bold; }
        .status-warning { color: #f39c12; font-weight: bold; }
        pre { 
            background: #f5f5f5; 
            padding: 10px; 
            overflow-x: auto; 
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .button {
            background: #ff6b35;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
        }
        .button:hover { background: #e55a2e; }
        iframe {
            width: 100%;
            height: 600px;
            border: 2px solid #ddd;
            border-radius: 8px;
            background: white;
        }
        .screenshot-container {
            margin: 20px 0;
            text-align: center;
        }
        .issue-item {
            background: #fff3cd;
            border-left: 4px solid #f39c12;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .fix-item {
            background: #d4edda;
            border-left: 4px solid #27ae60;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>üî• Capture et Analyse de l'Interface Fire Salamander</h1>
    
    <div class="section">
        <h2>1. Capture de l'Interface</h2>
        <p>L'interface Fire Salamander devrait s'afficher ci-dessous :</p>
        <iframe id="fire-interface" src="http://localhost:8080" title="Fire Salamander Interface"></iframe>
        
        <div style="margin-top: 20px;">
            <button class="button" onclick="captureInterface()">üì∏ Capturer l'√âtat Actuel</button>
            <button class="button" onclick="analyzeDisplay()">üîç Analyser l'Affichage</button>
            <button class="button" onclick="testInteractions()">‚ö° Tester les Interactions</button>
        </div>
    </div>
    
    <div class="section">
        <h2>2. Analyse des Probl√®mes d'Affichage</h2>
        <div id="display-analysis"></div>
    </div>
    
    <div class="section">
        <h2>3. √âtat du DOM</h2>
        <div id="dom-state"></div>
    </div>
    
    <div class="section">
        <h2>4. Erreurs Console de l'iFrame</h2>
        <div id="iframe-errors"></div>
    </div>
    
    <div class="section">
        <h2>5. Solutions Propos√©es</h2>
        <div id="solutions"></div>
    </div>

    <script>
        // Capturer l'interface
        async function captureInterface() {
            const container = document.getElementById('dom-state');
            container.innerHTML = '<p>Capture en cours...</p>';
            
            try {
                const iframe = document.getElementById('fire-interface');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Capturer le HTML
                const html = iframeDoc.documentElement.outerHTML;
                
                // Capturer les styles calcul√©s des √©l√©ments importants
                const styles = {};
                const elements = {
                    'body': iframeDoc.body,
                    'navbar': iframeDoc.querySelector('.navbar'),
                    'main-content': iframeDoc.querySelector('.main-content'),
                    'dashboard': iframeDoc.querySelector('#dashboard-page')
                };
                
                for (const [name, element] of Object.entries(elements)) {
                    if (element) {
                        const computedStyle = iframe.contentWindow.getComputedStyle(element);
                        styles[name] = {
                            display: computedStyle.display,
                            visibility: computedStyle.visibility,
                            backgroundColor: computedStyle.backgroundColor,
                            color: computedStyle.color,
                            fontFamily: computedStyle.fontFamily,
                            width: computedStyle.width,
                            height: computedStyle.height
                        };
                    }
                }
                
                container.innerHTML = `
                    <h3>√âtat du DOM Captur√©</h3>
                    <p><span class="status-ok">‚úÖ Capture r√©ussie</span></p>
                    <h4>Styles Calcul√©s:</h4>
                    <pre>${JSON.stringify(styles, null, 2)}</pre>
                    <details>
                        <summary>HTML Complet</summary>
                        <pre>${html.replace(/</g, '&lt;').replace(/>/g, '&gt;')}</pre>
                    </details>
                `;
            } catch (error) {
                container.innerHTML = `<span class="status-error">‚ùå Erreur de capture:</span> ${error.message}`;
            }
        }
        
        // Analyser l'affichage
        async function analyzeDisplay() {
            const container = document.getElementById('display-analysis');
            container.innerHTML = '<p>Analyse en cours...</p>';
            
            const issues = [];
            const fixes = [];
            
            try {
                const iframe = document.getElementById('fire-interface');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // V√©rifier si le CSS est charg√©
                const cssLink = iframeDoc.querySelector('link[href*="styles.css"]');
                if (!cssLink) {
                    issues.push({
                        type: 'CSS manquant',
                        description: 'Le fichier CSS n\'est pas r√©f√©renc√© dans le HTML'
                    });
                    fixes.push({
                        type: 'Ajouter r√©f√©rence CSS',
                        description: 'V√©rifier que le lien vers styles.css est correct dans index.html'
                    });
                } else {
                    // V√©rifier si le CSS est r√©ellement charg√©
                    const sheet = cssLink.sheet;
                    if (!sheet) {
                        issues.push({
                            type: 'CSS non charg√©',
                            description: 'Le fichier CSS est r√©f√©renc√© mais n\'est pas charg√©'
                        });
                        fixes.push({
                            type: 'Corriger le chemin CSS',
                            description: 'Le chemin est maintenant /styles.css (absolu)'
                        });
                    }
                }
                
                // V√©rifier les √©l√©ments visibles
                const navbar = iframeDoc.querySelector('.navbar');
                const mainContent = iframeDoc.querySelector('.main-content');
                const dashboard = iframeDoc.querySelector('#dashboard-page');
                
                if (!navbar) {
                    issues.push({
                        type: 'Navigation manquante',
                        description: 'L\'√©l√©ment .navbar n\'existe pas dans le DOM'
                    });
                }
                
                if (!mainContent) {
                    issues.push({
                        type: 'Contenu principal manquant',
                        description: 'L\'√©l√©ment .main-content n\'existe pas dans le DOM'
                    });
                }
                
                // V√©rifier les variables CSS
                const rootStyles = iframe.contentWindow.getComputedStyle(iframeDoc.documentElement);
                const primaryColor = rootStyles.getPropertyValue('--primary-color');
                if (!primaryColor) {
                    issues.push({
                        type: 'Variables CSS manquantes',
                        description: 'Les variables CSS personnalis√©es ne sont pas d√©finies'
                    });
                    fixes.push({
                        type: 'Charger les styles',
                        description: 'S\'assurer que le fichier CSS contenant les variables est bien charg√©'
                    });
                }
                
                // V√©rifier JavaScript
                if (!iframe.contentWindow.app) {
                    issues.push({
                        type: 'JavaScript non initialis√©',
                        description: 'L\'objet app n\'est pas d√©fini dans window'
                    });
                    fixes.push({
                        type: 'V√©rifier app.js',
                        description: 'S\'assurer que app.js est charg√© et que l\'initialisation se fait correctement'
                    });
                }
                
                // Afficher les r√©sultats
                let html = '<h3>R√©sultats de l\'analyse:</h3>';
                
                if (issues.length === 0) {
                    html += '<p><span class="status-ok">‚úÖ Aucun probl√®me d√©tect√©!</span></p>';
                } else {
                    html += '<h4>Probl√®mes d√©tect√©s:</h4>';
                    issues.forEach(issue => {
                        html += `<div class="issue-item">
                            <strong>${issue.type}:</strong> ${issue.description}
                        </div>`;
                    });
                    
                    html += '<h4>Solutions propos√©es:</h4>';
                    fixes.forEach(fix => {
                        html += `<div class="fix-item">
                            <strong>${fix.type}:</strong> ${fix.description}
                        </div>`;
                    });
                }
                
                container.innerHTML = html;
                
            } catch (error) {
                container.innerHTML = `<span class="status-error">‚ùå Erreur d'analyse:</span> ${error.message}`;
            }
        }
        
        // Tester les interactions
        async function testInteractions() {
            const container = document.getElementById('iframe-errors');
            container.innerHTML = '<p>Test des interactions...</p>';
            
            try {
                const iframe = document.getElementById('fire-interface');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                // Essayer de cliquer sur le lien Analyser
                const analyzerLink = iframeDoc.querySelector('a[data-page="analyzer"]');
                if (analyzerLink) {
                    analyzerLink.click();
                    
                    // Attendre un peu
                    await new Promise(resolve => setTimeout(resolve, 1000));
                    
                    // V√©rifier si la page a chang√©
                    const analyzerPage = iframeDoc.querySelector('#analyzer-page');
                    const isVisible = analyzerPage && analyzerPage.classList.contains('active');
                    
                    container.innerHTML = `
                        <h3>Test d'interaction:</h3>
                        <p>Navigation vers Analyser: <span class="${isVisible ? 'status-ok' : 'status-error'}">
                            ${isVisible ? '‚úÖ R√©ussie' : '‚ùå √âchou√©e'}
                        </span></p>
                    `;
                } else {
                    container.innerHTML = '<span class="status-error">‚ùå Lien Analyser non trouv√©</span>';
                }
            } catch (error) {
                container.innerHTML = `<span class="status-error">‚ùå Erreur de test:</span> ${error.message}`;
            }
        }
        
        // Solutions automatiques
        function showSolutions() {
            const container = document.getElementById('solutions');
            container.innerHTML = `
                <h3>Solutions Recommand√©es:</h3>
                <ol>
                    <li><strong>V√©rifier le serveur web:</strong>
                        <pre>curl -I http://localhost:8080/styles.css</pre>
                    </li>
                    <li><strong>Inspecter les logs du serveur:</strong>
                        <pre>tail -f fire-salamander.log</pre>
                    </li>
                    <li><strong>Tester directement les ressources:</strong>
                        <ul>
                            <li><a href="http://localhost:8080/styles.css" target="_blank">Ouvrir styles.css</a></li>
                            <li><a href="http://localhost:8080/app.js" target="_blank">Ouvrir app.js</a></li>
                        </ul>
                    </li>
                    <li><strong>Relancer Fire Salamander:</strong>
                        <pre>./fire-salamander --config config.yaml</pre>
                    </li>
                </ol>
            `;
        }
        
        // Au chargement
        window.onload = () => {
            showSolutions();
            
            // √âcouter les messages d'erreur de l'iframe
            window.addEventListener('message', (event) => {
                if (event.origin === 'http://localhost:8080') {
                    console.log('Message de l\'iframe:', event.data);
                }
            });
        };
    </script>
</body>
</html>